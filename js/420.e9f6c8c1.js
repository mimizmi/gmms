"use strict";(self["webpackChunkgdmu_mentor_selection"]=self["webpackChunkgdmu_mentor_selection"]||[]).push([[420],{6135:function(e,a,l){l.d(a,{LP:function(){return d},OT:function(){return s},TM:function(){return n},Y:function(){return r},e_:function(){return t},jw:function(){return c},nf:function(){return v},tQ:function(){return i},ws:function(){return o}});var u=l(5720);function t(e,a){return(0,u.A)({url:"/api/Student/get-unset",method:"get",params:{gde:e,mjr:a}})}function n(e){return(0,u.A)({url:"/api/Student/update-info",method:"post",data:e})}function o(e,a){return(0,u.A)({url:"/api/Student/update-password",method:"post",params:{id:e,newPassword:a}})}function r(){return(0,u.A)({url:"/api/Student",method:"get"})}function i(e,a){return(0,u.A)({url:`/api/Student/update/${e}`,method:"post",data:a})}function s(e,a){return(0,u.A)({url:"/api/Student/update-password",method:"post",params:{id:e,newPassword:a}})}function d(e){return(0,u.A)({url:`/api/Student/delete/${e}`,method:"post"})}function c(e){return(0,u.A)({url:"/api/Student",method:"post",data:e})}function v(e){return(0,u.A)({url:"/api/Student/bulk-create",method:"post",data:e})}},420:function(e,a,l){l.r(a),l.d(a,{default:function(){return j}});l(4114),l(8992),l(4520),l(2577),l(3949),l(1454),l(7550);var u=l(6768),t=l(4232),n=l(144),o=l(1387),r=l(8500),i=l(3555),s=l(1219),d=l(2933),c=l(6135),v=l(7477),p=l(1419),f=l(1527),_=l.n(f);const g={class:"my-group"},m={class:"card-header"},b={class:"header-actions"},k={class:"member-section"},h={class:"section-header"},y={class:"header-left"},w={class:"teacher-section"},F={class:"section-header"},W={class:"member-info"},C={class:"search-bar"},x={class:"dialog-footer"},I={class:"selected-count"},R={key:0,class:"selected-teachers"},V={class:"teacher-item"},L={class:"volunteer-index"},K={class:"teacher-name"},A={class:"dialog-footer"};var S={__name:"my-group",setup(e){const a=(0,o.rd)(),l=(0,r.k)(),f=(0,n.KR)(!1),S=(0,n.KR)({}),X=(0,n.KR)([]),$=(0,n.KR)(!1),j=(0,n.KR)(!1),E=(0,u.EW)((()=>{if(!l.userInfo)return!1;const e=l.userInfo.stu_id;return X.value.some((a=>a.stu_id===e&&a.stu_lead))})),T=(0,n.KR)(null),U=(0,u.EW)((()=>T.value&&0!==T.value.tea_id)),B=async()=>{if(!j.value&&l.userInfo){f.value=!0;try{const u=l.userInfo.stu_group;if(!u)return void a.push("/student/group");const[t,n,o]=await Promise.all([(0,i.Qo)(u),(0,i.kQ)(u),(0,i.oZ)(u)]);if(j.value)return;if(S.value=t||{},X.value=n||[],T.value=o,U.value)ue.value=[];else try{const e=await(0,i.Bs)(u);if(j.value)return;ue.value=e?.teachers||[]}catch(e){if(404!==e.response?.status)throw e;ue.value=[]}}catch(e){j.value||(s.nk.error("获取小组信息失败"),X.value=[],a.push("/student/group"))}finally{j.value||(f.value=!1)}}},Q=(0,n.KR)(!1),P=(0,n.KR)(null),q=(0,n.KR)({group_name:"",group_title:"",group_info:""}),M={group_name:[{required:!0,message:"请输入小组名称",trigger:"blur"},{max:30,message:"小组名称不能超过30个字符",trigger:"blur"}],group_title:[{required:!0,message:"请输入选题",trigger:"blur"},{max:30,message:"选题不能超过30个字符",trigger:"blur"}],group_info:[{required:!0,message:"请输入描述",trigger:"blur"},{max:200,message:"描述不能超过200个字符",trigger:"blur"}]},N=()=>{q.value={...S.value,major:S.value.major,grade:S.value.grade},Q.value=!0},z=async()=>{P.value&&await P.value.validate((async e=>{if(e){f.value=!0;try{await(0,i.T6)(q.value),s.nk.success("修改成功"),Q.value=!1,await B()}catch(a){s.nk.error("修改失败")}finally{f.value=!1}}}))},O=(0,n.KR)(!1),Y=(0,n.KR)([]),D=(0,n.KR)([]),J=(0,n.KR)(""),Z=(0,n.KR)(null),G=(0,u.EW)((()=>{if(!J.value)return D.value;const e=J.value.toLowerCase();return D.value.filter((a=>a.stu_num.toLowerCase().includes(e)||a.stu_name.toLowerCase().includes(e)))})),H=e=>{const a=l.configInfo?.max_group_member||0,t=a-X.value.length;if(e.length<Y.value.length)Y.value=e.map((e=>e.stu_id));else{if(e.length>t)return s.nk.warning(`最多只能选择 ${t} 人`),void(0,u.dY)((()=>{Y.value.forEach((e=>{const a=D.value.find((a=>a.stu_id===e));a&&Z.value?.toggleRowSelection(a,!0)})),D.value.forEach((e=>{Y.value.includes(e.stu_id)||(Z.value?.toggleRowSelection(e,!1),e.disabled=!0)}))}));D.value.forEach((e=>{e.disabled=!1})),Y.value=e.map((e=>e.stu_id))}},ee=async()=>{if(Y.value.length)if(X.value.length+Y.value.length>l.configInfo?.max_group_member)s.nk.warning(`小组成员不能超过${l.configInfo?.max_group_member}人`);else{f.value=!0;try{const e=S.value?.grade||l.userInfo.stu_gde,a=S.value?.major||l.userInfo.stu_mjr,u=await(0,c.e_)(e,a),t=u.map((e=>e.stu_id)),n=[],o=[];for(const l of Y.value)if(t.includes(l))n.push(l);else{const e=D.value.find((e=>e.stu_id===l));e&&o.push(e.stu_name)}if(o.length>0)return void d.s.alert(`以下学生已加入其他小组，请重新选择：\n${o.join("、")}`,"提示").then((()=>{fe()}));console.log("添加组员请求:",{groupId:S.value.group_id,studentIds:n}),await(0,i.i1)(S.value.group_id,n),s.nk.success("添加成功"),O.value=!1,await B()}catch(e){console.error("添加组员失败:",e),s.nk.error("添加失败，请重试")}finally{f.value=!1}}},ae=(0,n.KR)(!1),le=(0,n.KR)([]),ue=(0,n.KR)([]),te=e=>{if(_e(e.tea_id))return;const a=l.configInfo?.max_stu_choice||0;ue.value.length>=a?s.nk.warning(`最多只能选择 ${a} 个导师`):ue.value.push(e)},ne=()=>{$.value||B(),le.value=[]},oe=async()=>{if(!ue.value.length)return void s.nk.warning("请至少选择一个导师");const e=l.configInfo?.max_stu_choice||0;if(ue.value.length>e)s.nk.warning(`最多只能选择 ${e} 个导师`);else{$.value=!0;try{await(0,i.D9)(S.value.group_id,ue.value.map((e=>e.tea_id))),s.nk.success("预选成功"),ae.value=!1}catch(a){s.nk.error("预选失败")}finally{$.value=!1}}},re=()=>{q.value={group_name:"",group_title:"",group_info:""}},ie=()=>{Y.value=[],D.value=[],J.value=""},se=e=>{const a={0:{type:"",class:"gold-tag"},1:{type:"",class:"silver-tag"},2:{type:"",class:"bronze-tag"}};return a[e]||{type:"info",class:""}},de=async e=>{if(!j.value)try{await a.push(e)}catch(l){console.error("Navigation error:",l)}};(0,u.xo)((()=>{j.value=!0,f.value&&(f.value=!1),window._routeChanging=!1})),(0,u.sV)((()=>{if(l.userInfo)B();else{const e=(0,p.Ri)("userInfo");e?(l.userInfo=JSON.parse(e),B()):a.push("/student/login")}}));const ce=async e=>{await d.s.confirm(`确定要移除成员 ${e.stu_name} 吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),f.value=!0;try{await(0,i.A0)(S.value.group_id,e.stu_id),s.nk.success("移除成功"),await B()}catch(a){s.nk.error("移除失败")}finally{f.value=!1}},ve=async()=>{if(!j.value&&!f.value)try{await d.s.confirm("确定要退出小组吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),f.value=!0,await(0,i.A0)(S.value.group_id,l.userInfo.stu_id),j.value||(s.nk.success("退出成功"),l.userInfo.stu_group=null,await de("/student/group"))}catch(e){j.value||"cancel"===e||s.nk.error("退出失败")}finally{j.value||(f.value=!1)}},pe=async()=>{try{await d.s.confirm("确定要解散小组吗？此操作不可恢复！","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),f.value=!0,await(0,i.Ao)(S.value.group_id,l.userInfo.stu_id),s.nk.success("解散成功"),l.userInfo.stu_group=null,a.push("/student/group")}catch(e){"cancel"!==e&&s.nk.error("解散失败")}finally{f.value=!1}},fe=async()=>{Y.value=[],D.value=[],f.value=!0;try{const e=S.value?.grade||l.userInfo.stu_gde,a=S.value?.major||l.userInfo.stu_mjr,u=await(0,c.e_)(e,a);D.value=u||[],O.value=!0}catch(e){s.nk.error("获取可添加学生失败"),D.value=[]}finally{f.value=!1}},_e=e=>ue.value.some((a=>a.tea_id===e)),ge=e=>{const a=ue.value.findIndex((a=>a.tea_id===e));return-1===a?"选择":`志愿${a+1}`},me=e=>{const a=ue.value.findIndex((a=>a.tea_id===e.tea_id));a>-1&&ue.value.splice(a,1)},be=async()=>{f.value=!0;try{const e=S.value?.major||l.userInfo.stu_mjr,a=await(0,i.Mm)(e);le.value=a||[],ae.value=!0}catch(e){s.nk.error("获取导师列表失败"),le.value=[]}finally{f.value=!1}};return(e,a)=>{const o=(0,u.g2)("el-button"),r=(0,u.g2)("el-descriptions-item"),i=(0,u.g2)("el-descriptions"),s=(0,u.g2)("el-tag"),d=(0,u.g2)("el-table-column"),c=(0,u.g2)("el-table"),p=(0,u.g2)("el-empty"),j=(0,u.g2)("el-card"),B=(0,u.g2)("el-input"),D=(0,u.g2)("el-form-item"),de=(0,u.g2)("el-form"),ke=(0,u.g2)("el-dialog"),he=(0,u.g2)("el-alert"),ye=(0,u.g2)("el-icon"),we=(0,u.gN)("loading");return(0,u.uX)(),(0,u.CE)("div",g,[(0,u.bo)(((0,u.uX)(),(0,u.Wv)(j,null,{header:(0,u.k6)((()=>[(0,u.Lk)("div",m,[a[15]||(a[15]=(0,u.Lk)("h3",null,"小组信息",-1)),(0,u.Lk)("div",b,[E.value?((0,u.uX)(),(0,u.CE)(u.FK,{key:0},[(0,u.bF)(o,{type:"primary",onClick:N},{default:(0,u.k6)((()=>a[11]||(a[11]=[(0,u.eW)(" 修改信息 ")]))),_:1}),(0,u.bF)(o,{type:"danger",onClick:pe},{default:(0,u.k6)((()=>a[12]||(a[12]=[(0,u.eW)(" 解散小组 ")]))),_:1})],64)):((0,u.uX)(),(0,u.CE)(u.FK,{key:1},[(0,u.bF)(o,{type:"primary",onClick:N},{default:(0,u.k6)((()=>a[13]||(a[13]=[(0,u.eW)(" 修改信息 ")]))),_:1}),(0,u.bF)(o,{type:"danger",onClick:ve},{default:(0,u.k6)((()=>a[14]||(a[14]=[(0,u.eW)(" 退出小组 ")]))),_:1})],64))])])])),default:(0,u.k6)((()=>[(0,u.bF)(i,{column:2,border:""},{default:(0,u.k6)((()=>[(0,u.bF)(r,{label:"小组名称"},{default:(0,u.k6)((()=>[(0,u.eW)((0,t.v_)(S.value.group_name),1)])),_:1}),(0,u.bF)(r,{label:"小组编号"},{default:(0,u.k6)((()=>[(0,u.eW)((0,t.v_)(S.value.group_id),1)])),_:1}),(0,u.bF)(r,{label:"选题"},{default:(0,u.k6)((()=>[(0,u.eW)((0,t.v_)(S.value.group_title),1)])),_:1}),(0,u.bF)(r,{label:"描述"},{default:(0,u.k6)((()=>[(0,u.eW)((0,t.v_)(S.value.group_info),1)])),_:1})])),_:1}),(0,u.Lk)("div",k,[(0,u.Lk)("div",h,[(0,u.Lk)("div",y,[a[16]||(a[16]=(0,u.Lk)("h4",null,"小组成员",-1)),(0,u.bF)(s,{type:"info",size:"small",class:"member-count"},{default:(0,u.k6)((()=>[(0,u.eW)((0,t.v_)(X.value.length)+"/"+(0,t.v_)((0,n.R1)(l).configInfo?.max_group_member||"-"),1)])),_:1})]),X.value.length<((0,n.R1)(l).configInfo?.max_group_member||0)?((0,u.uX)(),(0,u.Wv)(o,{key:0,type:"primary",onClick:fe},{default:(0,u.k6)((()=>a[17]||(a[17]=[(0,u.eW)(" 添加成员 ")]))),_:1})):(0,u.Q3)("",!0)]),(0,u.bF)(c,{data:X.value,stripe:""},{default:(0,u.k6)((()=>[(0,u.bF)(d,{prop:"stu_name",label:"姓名"}),(0,u.bF)(d,{prop:"stu_num",label:"学号"}),(0,u.bF)(d,{prop:"stu_cls",label:"班级"}),(0,u.bF)(d,{prop:"stu_phone",label:"联系方式"}),(0,u.bF)(d,{label:"身份"},{default:(0,u.k6)((e=>[(0,u.bF)(s,{type:e.row.stu_lead?"success":""},{default:(0,u.k6)((()=>[(0,u.eW)((0,t.v_)(e.row.stu_lead?"组长":"组员"),1)])),_:2},1032,["type"])])),_:1}),E.value?((0,u.uX)(),(0,u.Wv)(d,{key:0,label:"操作"},{default:(0,u.k6)((e=>[(0,u.bF)(o,{type:"danger",link:"",disabled:e.row.stu_lead,onClick:a=>ce(e.row)},{default:(0,u.k6)((()=>a[18]||(a[18]=[(0,u.eW)(" 移除 ")]))),_:2},1032,["disabled","onClick"])])),_:1})):(0,u.Q3)("",!0)])),_:1},8,["data"])]),(0,u.Lk)("div",w,[(0,u.Lk)("div",F,[a[20]||(a[20]=(0,u.Lk)("div",{class:"header-left"},[(0,u.Lk)("h4",null,"预选导师")],-1)),U.value?(0,u.Q3)("",!0):((0,u.uX)(),(0,u.Wv)(o,{key:0,type:"primary",onClick:be,disabled:!E.value||U.value},{default:(0,u.k6)((()=>a[19]||(a[19]=[(0,u.eW)(" 选择导师 ")]))),_:1},8,["disabled"]))]),U.value?((0,u.uX)(),(0,u.Wv)(i,{key:0,column:2,border:""},{default:(0,u.k6)((()=>[(0,u.bF)(r,{label:"姓名"},{default:(0,u.k6)((()=>[(0,u.eW)((0,t.v_)(T.value.tea_name),1)])),_:1}),(0,u.bF)(r,{label:"联系方式"},{default:(0,u.k6)((()=>[(0,u.eW)((0,t.v_)(T.value.tea_phone),1)])),_:1}),(0,u.bF)(r,{label:"个人介绍"},{default:(0,u.k6)((()=>[(0,u.eW)((0,t.v_)(T.value.tea_info),1)])),_:1})])),_:1})):ue.value.length?((0,u.uX)(),(0,u.Wv)(c,{key:1,data:ue.value,stripe:""},{default:(0,u.k6)((()=>[(0,u.bF)(d,{label:"志愿",width:"100"},{default:(0,u.k6)((e=>[(0,u.bF)(s,{class:(0,t.C4)(se(e.$index).class),type:se(e.$index).type},{default:(0,u.k6)((()=>[(0,u.eW)(" 第"+(0,t.v_)(e.$index+1)+"志愿 ",1)])),_:2},1032,["class","type"])])),_:1}),(0,u.bF)(d,{prop:"tea_name",label:"姓名"}),(0,u.bF)(d,{prop:"tea_phone",label:"联系方式"}),(0,u.bF)(d,{prop:"tea_info",label:"简介"})])),_:1},8,["data"])):((0,u.uX)(),(0,u.Wv)(p,{key:2,description:"暂未预选导师"}))])])),_:1})),[[we,f.value]]),(0,u.bF)(ke,{modelValue:Q.value,"onUpdate:modelValue":a[4]||(a[4]=e=>Q.value=e),title:"修改小组信息",width:"50%",onClosed:re},{footer:(0,u.k6)((()=>[(0,u.bF)(o,{onClick:a[3]||(a[3]=e=>Q.value=!1)},{default:(0,u.k6)((()=>a[21]||(a[21]=[(0,u.eW)("取消")]))),_:1}),(0,u.bF)(o,{type:"primary",onClick:z},{default:(0,u.k6)((()=>a[22]||(a[22]=[(0,u.eW)("确定")]))),_:1})])),default:(0,u.k6)((()=>[(0,u.bF)(de,{ref_key:"editFormRef",ref:P,model:q.value,rules:M,"label-width":"100px"},{default:(0,u.k6)((()=>[(0,u.bF)(D,{label:"小组名称",prop:"group_name"},{default:(0,u.k6)((()=>[(0,u.bF)(B,{modelValue:q.value.group_name,"onUpdate:modelValue":a[0]||(a[0]=e=>q.value.group_name=e),maxlength:"30","show-word-limit":""},null,8,["modelValue"])])),_:1}),(0,u.bF)(D,{label:"选题",prop:"group_title"},{default:(0,u.k6)((()=>[(0,u.bF)(B,{modelValue:q.value.group_title,"onUpdate:modelValue":a[1]||(a[1]=e=>q.value.group_title=e),maxlength:"30","show-word-limit":""},null,8,["modelValue"])])),_:1}),(0,u.bF)(D,{label:"描述",prop:"group_info"},{default:(0,u.k6)((()=>[(0,u.bF)(B,{modelValue:q.value.group_info,"onUpdate:modelValue":a[2]||(a[2]=e=>q.value.group_info=e),type:"textarea",rows:3,maxlength:"200","show-word-limit":""},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue"]),(0,u.bF)(ke,{modelValue:O.value,"onUpdate:modelValue":a[7]||(a[7]=e=>O.value=e),title:"添加成员",width:"50%",onClosed:ie},{footer:(0,u.k6)((()=>[(0,u.Lk)("div",x,[(0,u.Lk)("span",I,"已选择 "+(0,t.v_)(Y.value.length)+" 人",1),(0,u.Lk)("div",null,[(0,u.bF)(o,{onClick:a[6]||(a[6]=e=>O.value=!1)},{default:(0,u.k6)((()=>a[23]||(a[23]=[(0,u.eW)("取消")]))),_:1}),(0,u.bF)(o,{type:"primary",onClick:ee,loading:f.value,disabled:!Y.value.length},{default:(0,u.k6)((()=>a[24]||(a[24]=[(0,u.eW)(" 确定 ")]))),_:1},8,["loading","disabled"])])])])),default:(0,u.k6)((()=>[(0,u.Lk)("div",W,[(0,u.bF)(he,{title:`最多可选择 ${(0,n.R1)(l).configInfo?.max_group_member-X.value.length} 人`,type:"info",closable:!1,"show-icon":""},null,8,["title"])]),(0,u.Lk)("div",C,[(0,u.bF)(B,{modelValue:J.value,"onUpdate:modelValue":a[5]||(a[5]=e=>J.value=e),placeholder:"搜索学号/姓名",clearable:""},{prefix:(0,u.k6)((()=>[(0,u.bF)(ye,null,{default:(0,u.k6)((()=>[(0,u.bF)((0,n.R1)(v.vji))])),_:1})])),_:1},8,["modelValue"])]),(0,u.bo)(((0,u.uX)(),(0,u.Wv)(c,{ref_key:"memberTableRef",ref:Z,data:G.value,height:"400",onSelectionChange:H},{default:(0,u.k6)((()=>[(0,u.bF)(d,{type:"selection",width:"55"}),(0,u.bF)(d,{prop:"stu_name",label:"姓名"}),(0,u.bF)(d,{prop:"stu_num",label:"学号"}),(0,u.bF)(d,{prop:"stu_cls",label:"班级"})])),_:1},8,["data"])),[[we,f.value]])])),_:1},8,["modelValue"]),(0,u.bF)(ke,{modelValue:ae.value,"onUpdate:modelValue":a[10]||(a[10]=e=>ae.value=e),title:"预选导师志愿",width:"60%",onClosed:ne},{footer:(0,u.k6)((()=>[(0,u.Lk)("span",A,[(0,u.bF)(o,{onClick:a[9]||(a[9]=e=>ae.value=!1)},{default:(0,u.k6)((()=>a[27]||(a[27]=[(0,u.eW)("取消")]))),_:1}),(0,u.bF)(o,{type:"primary",onClick:oe,loading:$.value},{default:(0,u.k6)((()=>a[28]||(a[28]=[(0,u.eW)(" 确定 ")]))),_:1},8,["loading"])])])),default:(0,u.k6)((()=>[(0,u.bo)(((0,u.uX)(),(0,u.CE)("div",null,[ue.value.length?((0,u.uX)(),(0,u.CE)("div",R,[(0,u.bF)(he,{type:"info",closable:!1,"show-icon":""},{default:(0,u.k6)((()=>a[25]||(a[25]=[(0,u.eW)(" 拖动调整志愿顺序，排在前面的优先级更高 ")]))),_:1}),(0,u.bF)((0,n.R1)(_()),{modelValue:ue.value,"onUpdate:modelValue":a[8]||(a[8]=e=>ue.value=e),"item-key":"tea_id",handle:".drag-handle","ghost-class":"ghost",class:"selected-list"},{item:(0,u.k6)((({element:e,index:l})=>[(0,u.Lk)("div",V,[(0,u.bF)(ye,{class:"drag-handle"},{default:(0,u.k6)((()=>[(0,u.bF)((0,n.R1)(v.rgM))])),_:1}),(0,u.Lk)("span",L,"志愿"+(0,t.v_)(l+1),1),(0,u.Lk)("span",K,(0,t.v_)(e.tea_name),1),(0,u.bF)(o,{type:"danger",link:"",onClick:a=>me(e)},{default:(0,u.k6)((()=>a[26]||(a[26]=[(0,u.eW)(" 移除 ")]))),_:2},1032,["onClick"])])])),_:1},8,["modelValue"])])):(0,u.Q3)("",!0),(0,u.bF)(c,{ref:"teacherTableRef",data:le.value,style:{width:"100%"}},{default:(0,u.k6)((()=>[(0,u.bF)(d,{prop:"tea_name",label:"姓名"}),(0,u.bF)(d,{prop:"tea_phone",label:"联系方式"}),(0,u.bF)(d,{prop:"tea_info",label:"个人介绍","show-overflow-tooltip":""}),(0,u.bF)(d,{label:"操作",width:"120"},{default:(0,u.k6)((({row:e})=>[(0,u.bF)(o,{type:"primary",link:"",onClick:a=>te(e),disabled:_e(e.tea_id)},{default:(0,u.k6)((()=>[(0,u.eW)((0,t.v_)(ge(e.tea_id)),1)])),_:2},1032,["onClick","disabled"])])),_:1})])),_:1},8,["data"])])),[[we,f.value]])])),_:1},8,["modelValue"])])}}},X=l(1241);const $=(0,X.A)(S,[["__scopeId","data-v-de0319d2"]]);var j=$}}]);
//# sourceMappingURL=420.e9f6c8c1.js.map