"use strict";(self["webpackChunkgdmu_mentor_selection"]=self["webpackChunkgdmu_mentor_selection"]||[]).push([[302],{5302:function(e,l,a){a.r(l),a.d(l,{default:function(){return h}});a(6573),a(8100),a(7936),a(7467),a(4732),a(9577),a(8992),a(4520),a(2577),a(1454);var u=a(6768),t=a(144),r=a(4232),d=a(6135),n=a(4267),s=a(8298),o=a(1219),_=a(2933),i=a(7477),m=a(3230);const c={class:"student-manage"},p={class:"filter-section"},g={class:"filter-main"},b={class:"filter-actions"},f={class:"pagination"};var k={__name:"student-manage",setup(e){const l=(0,t.KR)(!1),a=(0,t.KR)(!1),k=(0,t.KR)([]),v=(0,t.KR)([]),F=(0,t.KR)([]),h=(0,t.Kh)({grade:"",major:"",keyword:"",unsetOnly:!1,leaderOnly:!1}),y=(0,t.KR)(1),w=(0,t.KR)(10),V=(0,t.KR)(!1),j=(0,t.KR)(null),W=(0,t.KR)(null),C=(0,t.Kh)({stu_id:"",stu_num:"",stu_name:"",stu_gde:"",stu_mjr:"",stu_cls:1,stu_phone:"",stu_group:null,stu_lead:!1,stu_info:""}),x={stu_num:[{required:!0,message:"请输入学号",trigger:"blur"},{pattern:/^\d{11}$/,message:"学号必须为11位数字",trigger:"blur"}],stu_name:[{required:!0,message:"请输入姓名",trigger:"blur"}],stu_gde:[{required:!0,message:"请选择年级",trigger:"change"}],stu_mjr:[{required:!0,message:"请选择专业",trigger:"change"}],stu_cls:[{required:!0,message:"请输入班级",trigger:"blur"}],stu_phone:[{required:!0,message:"请输入联系方式",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号码",trigger:"blur"}]},R=(0,u.EW)((()=>{let e=[...k.value];if(h.grade&&(e=e.filter((e=>e.stu_gde===h.grade))),h.major&&(e=e.filter((e=>e.stu_mjr===h.major))),h.keyword){const l=h.keyword.toLowerCase();e=e.filter((e=>e.stu_num.toLowerCase().includes(l)||e.stu_name.toLowerCase().includes(l)))}return h.unsetOnly&&(e=e.filter((e=>!e.stu_group))),h.leaderOnly&&(e=e.filter((e=>e.stu_lead))),e})),K=(0,u.EW)((()=>{const e=(y.value-1)*w.value,l=e+w.value;return R.value.slice(e,l)})),U=async()=>{l.value=!0;try{const[e,l,a]=await Promise.all([(0,d.Y)(),(0,n.O)(),(0,s.Q)()]);k.value=e,v.value=l,F.value=a}catch(e){o.nk.error("获取数据失败")}finally{l.value=!1}},E=()=>{y.value=1},X=()=>{h.grade="",h.major="",h.keyword="",h.unsetOnly=!1,h.leaderOnly=!1,y.value=1},O=e=>{Object.assign(C,{stu_id:e.stu_id,stu_num:e.stu_num,stu_name:e.stu_name,stu_gde:e.stu_gde,stu_mjr:e.stu_mjr,stu_cls:e.stu_cls,stu_phone:e.stu_phone,stu_group:e.stu_group,stu_lead:e.stu_lead,stu_info:e.stu_info}),W.value={...e},V.value=!0},L=async()=>{if(j.value)try{await j.value.validate(),a.value=!0;const e=v.value.find((e=>e.gde_value===C.stu_gde))?.gde_id,l=F.value.find((e=>e.mjr_name===C.stu_mjr))?.mjr_id;if(!e||!l)throw new Error("年级或专业信息错误");const u={stu_num:C.stu_num,stu_name:C.stu_name,stu_gde:e,stu_mjr:l,stu_cls:C.stu_cls,stu_phone:C.stu_phone||"",stu_info:C.stu_info||"",stu_group:C.stu_group,stu_lead:C.stu_lead};C.stu_id?(await(0,d.tQ)(C.stu_id,u),o.nk.success("修改成功")):(await(0,d.jw)(u),o.nk.success("添加成功")),V.value=!1,U()}catch(e){o.nk.error(e.message||"操作失败")}finally{a.value=!1}},$=async e=>{try{await _.s.confirm(`确定要将学生 ${e.stu_name}(${e.stu_num}) 的密码重置为学号后六位吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const l=e.stu_num.slice(-6);await(0,d.OT)(e.stu_id,l),o.nk.success("密码重置成功")}catch(l){"cancel"!==l&&o.nk.error("密码重置失败")}},q=async e=>{try{await _.s.confirm(`确定要删除学生 ${e.stu_name}(${e.stu_num}) 吗？此操作不可恢复！`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await(0,d.LP)(e.stu_id),o.nk.success("删除成功"),U()}catch(l){"cancel"!==l&&o.nk.error("删除失败")}},z=e=>{w.value=e,y.value=1},I=e=>{y.value=e},N=(0,t.KR)(!1),B=(0,t.KR)(!1),S=(0,t.KR)(null),T=(0,t.Kh)({grade:"",major:"",file:null}),A={grade:[{required:!0,message:"请选择年级",trigger:"change"}],major:[{required:!0,message:"请选择专业",trigger:"change"}],file:[{required:!0,message:"请选择Excel文件",trigger:"change"}]},P=()=>{C.stu_id="",C.stu_num="",C.stu_name="",C.stu_gde="",C.stu_mjr="",C.stu_cls=1,C.stu_phone="",C.stu_info="",V.value=!0},Q=e=>{T.file=e.raw},M=()=>{T.grade="",T.major="",T.file=null,N.value=!0},Y=()=>{const e=[["学号","姓名","班级","联系方式","备注"],["22209010008","张三","1","13800138000",""]],l=m.Wp.aoa_to_sheet(e),a=m.Wp.book_new();m.Wp.book_append_sheet(a,l,"学生信息"),l["!cols"]=[{wch:15},{wch:10},{wch:8},{wch:15},{wch:20}],m._h(a,"学生信息导入模板.xlsx")},D=async()=>{if(S.value)try{await S.value.validate(),B.value=!0;const e=new FileReader;e.onload=async e=>{try{const l=new Uint8Array(e.target.result),a=m.LF(l,{type:"array"}),u=a.Sheets[a.SheetNames[0]],t=m.Wp.sheet_to_json(u,{range:1,header:["学号","姓名","班级","联系方式","备注"]}),r=t.filter((e=>e["学号"]&&e["姓名"]&&e["班级"])).map((e=>{if(!/^\d{11}$/.test(String(e["学号"])))throw new Error(`学号 ${e["学号"]} 格式不正确，必须为11位数字`);const l=Number(e["班级"]);if(isNaN(l)||l<1||l>100)throw new Error(`班级 ${e["班级"]} 格式不正确，必须为1-100之间的数字`);return{stu_num:e["学号"],stu_name:e["姓名"],stu_gde:Number(T.grade),stu_mjr:Number(T.major),stu_cls:l,stu_phone:e["联系方式"],stu_info:e["备注"]}}));if(0===r.length)throw new Error("没有可导入的数据");await(0,d.nf)(r),o.nk.success("导入成功"),N.value=!1,U()}catch(l){o.nk.error(l.message||"导入失败，请检查数据格式是否正确")}finally{B.value=!1}},e.readAsArrayBuffer(T.file)}catch(e){o.nk.error("请检查表单填写是否正确"),B.value=!1}};return(0,u.sV)((()=>{U()})),(e,d)=>{const n=(0,u.g2)("el-option"),s=(0,u.g2)("el-select"),o=(0,u.g2)("el-form-item"),_=(0,u.g2)("el-icon"),m=(0,u.g2)("el-input"),k=(0,u.g2)("el-checkbox"),W=(0,u.g2)("el-button"),G=(0,u.g2)("el-form"),H=(0,u.g2)("el-table-column"),J=(0,u.g2)("el-tag"),Z=(0,u.g2)("el-table"),ee=(0,u.g2)("el-pagination"),le=(0,u.g2)("el-input-number"),ae=(0,u.g2)("el-switch"),ue=(0,u.g2)("el-dialog"),te=(0,u.g2)("el-upload"),re=(0,u.gN)("loading");return(0,u.uX)(),(0,u.CE)("div",c,[d[37]||(d[37]=(0,u.Lk)("div",{class:"page-header"},[(0,u.Lk)("h2",null,"学生管理"),(0,u.Lk)("div",{class:"header-desc"},"管理所有学生信息，支持修改信息和重置密码")],-1)),(0,u.Lk)("div",p,[(0,u.bF)(G,{inline:!0,model:h,class:"filter-form"},{default:(0,u.k6)((()=>[(0,u.Lk)("div",g,[(0,u.bF)(o,{label:"年级"},{default:(0,u.k6)((()=>[(0,u.bF)(s,{modelValue:h.grade,"onUpdate:modelValue":d[0]||(d[0]=e=>h.grade=e),clearable:"",placeholder:"选择年级",style:{width:"160px"}},{default:(0,u.k6)((()=>[((0,u.uX)(!0),(0,u.CE)(u.FK,null,(0,u.pI)(v.value,(e=>((0,u.uX)(),(0,u.Wv)(n,{key:e.gde_id,label:`${e.gde_value}级`,value:e.gde_value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,u.bF)(o,{label:"专业"},{default:(0,u.k6)((()=>[(0,u.bF)(s,{modelValue:h.major,"onUpdate:modelValue":d[1]||(d[1]=e=>h.major=e),clearable:"",placeholder:"选择专业",style:{width:"240px"}},{default:(0,u.k6)((()=>[((0,u.uX)(!0),(0,u.CE)(u.FK,null,(0,u.pI)(F.value,(e=>((0,u.uX)(),(0,u.Wv)(n,{key:e.mjr_id,label:e.mjr_name,value:e.mjr_name},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,u.bF)(o,{label:"搜索"},{default:(0,u.k6)((()=>[(0,u.bF)(m,{modelValue:h.keyword,"onUpdate:modelValue":d[2]||(d[2]=e=>h.keyword=e),placeholder:"搜索学号/姓名",clearable:"",style:{width:"200px"}},{prefix:(0,u.k6)((()=>[(0,u.bF)(_,null,{default:(0,u.k6)((()=>[(0,u.bF)((0,t.R1)(i.vji))])),_:1})])),_:1},8,["modelValue"])])),_:1}),(0,u.bF)(o,null,{default:(0,u.k6)((()=>[(0,u.bF)(k,{modelValue:h.unsetOnly,"onUpdate:modelValue":d[3]||(d[3]=e=>h.unsetOnly=e)},{default:(0,u.k6)((()=>d[20]||(d[20]=[(0,u.eW)("仅显示未分组学生")]))),_:1},8,["modelValue"]),(0,u.bF)(k,{modelValue:h.leaderOnly,"onUpdate:modelValue":d[4]||(d[4]=e=>h.leaderOnly=e),style:{"margin-left":"15px"}},{default:(0,u.k6)((()=>d[21]||(d[21]=[(0,u.eW)("仅显示组长")]))),_:1},8,["modelValue"])])),_:1})]),(0,u.Lk)("div",b,[(0,u.bF)(o,null,{default:(0,u.k6)((()=>[(0,u.bF)(W,{type:"primary",onClick:E},{default:(0,u.k6)((()=>[(0,u.bF)(_,null,{default:(0,u.k6)((()=>[(0,u.bF)((0,t.R1)(i.vji))])),_:1}),d[22]||(d[22]=(0,u.eW)(" 搜索 "))])),_:1}),(0,u.bF)(W,{type:"success",onClick:X},{default:(0,u.k6)((()=>[(0,u.bF)(_,null,{default:(0,u.k6)((()=>[(0,u.bF)((0,t.R1)(i.C42))])),_:1}),d[23]||(d[23]=(0,u.eW)(" 重置筛选 "))])),_:1}),(0,u.bF)(W,{type:"primary",onClick:U},{default:(0,u.k6)((()=>[(0,u.bF)(_,null,{default:(0,u.k6)((()=>[(0,u.bF)((0,t.R1)(i.C42))])),_:1}),d[24]||(d[24]=(0,u.eW)(" 刷新数据 "))])),_:1})])),_:1}),(0,u.bF)(o,null,{default:(0,u.k6)((()=>[(0,u.bF)(W,{type:"success",onClick:P},{default:(0,u.k6)((()=>[(0,u.bF)(_,null,{default:(0,u.k6)((()=>[(0,u.bF)((0,t.R1)(i.FWt))])),_:1}),d[25]||(d[25]=(0,u.eW)(" 添加学生 "))])),_:1}),(0,u.bF)(W,{type:"warning",onClick:M},{default:(0,u.k6)((()=>[(0,u.bF)(_,null,{default:(0,u.k6)((()=>[(0,u.bF)((0,t.R1)(i._OO))])),_:1}),d[26]||(d[26]=(0,u.eW)(" 批量导入 "))])),_:1})])),_:1})])])),_:1},8,["model"])]),(0,u.bo)(((0,u.uX)(),(0,u.Wv)(Z,{data:K.value,stripe:"",style:{width:"100%"},"header-cell-style":{background:"#fafafa",color:"#606266",fontWeight:600},"cell-style":{padding:"12px 0",fontSize:"14px"},border:""},{default:(0,u.k6)((()=>[(0,u.bF)(H,{prop:"stu_num",label:"学号",width:"120"}),(0,u.bF)(H,{prop:"stu_name",label:"姓名",width:"100"}),(0,u.bF)(H,{prop:"stu_gde",label:"年级",width:"100"},{default:(0,u.k6)((({row:e})=>[(0,u.eW)((0,r.v_)(e.stu_gde)+"级 ",1)])),_:1}),(0,u.bF)(H,{prop:"stu_mjr",label:"专业","min-width":"180"}),(0,u.bF)(H,{prop:"stu_cls",label:"班级",width:"80"}),(0,u.bF)(H,{prop:"stu_phone",label:"联系方式",width:"120"}),(0,u.bF)(H,{prop:"stu_group",label:"小组",width:"100"},{default:(0,u.k6)((({row:e})=>[(0,u.bF)(J,{type:e.stu_group?"success":"warning",effect:"dark"},{default:(0,u.k6)((()=>[(0,u.eW)((0,r.v_)(e.stu_group?`${e.stu_group}号小组`:"未分组"),1)])),_:2},1032,["type"])])),_:1}),(0,u.bF)(H,{label:"组长",width:"80"},{default:(0,u.k6)((({row:e})=>[(0,u.bF)(J,{type:e.stu_lead?"success":"info",effect:"dark"},{default:(0,u.k6)((()=>[(0,u.eW)((0,r.v_)(e.stu_lead?"是":"否"),1)])),_:2},1032,["type"])])),_:1}),(0,u.bF)(H,{label:"操作",width:"200",fixed:"right"},{default:(0,u.k6)((({row:e})=>[(0,u.bF)(W,{type:"primary",link:"",onClick:l=>O(e)},{default:(0,u.k6)((()=>d[27]||(d[27]=[(0,u.eW)(" 编辑 ")]))),_:2},1032,["onClick"]),(0,u.bF)(W,{type:"warning",link:"",onClick:l=>$(e)},{default:(0,u.k6)((()=>d[28]||(d[28]=[(0,u.eW)(" 重置密码 ")]))),_:2},1032,["onClick"]),(0,u.bF)(W,{type:"danger",link:"",onClick:l=>q(e)},{default:(0,u.k6)((()=>d[29]||(d[29]=[(0,u.eW)(" 删除 ")]))),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])),[[re,l.value]]),(0,u.Lk)("div",f,[(0,u.bF)(ee,{"current-page":y.value,"onUpdate:currentPage":d[5]||(d[5]=e=>y.value=e),"page-size":w.value,"onUpdate:pageSize":d[6]||(d[6]=e=>w.value=e),total:R.value.length,"page-sizes":[10,20,30,50],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:z,onCurrentChange:I},null,8,["current-page","page-size","total"])]),(0,u.bF)(ue,{modelValue:V.value,"onUpdate:modelValue":d[15]||(d[15]=e=>V.value=e),title:"编辑学生信息",width:"50%"},{footer:(0,u.k6)((()=>[(0,u.bF)(W,{onClick:d[14]||(d[14]=e=>V.value=!1)},{default:(0,u.k6)((()=>d[30]||(d[30]=[(0,u.eW)("取消")]))),_:1}),(0,u.bF)(W,{type:"primary",onClick:L,loading:a.value},{default:(0,u.k6)((()=>d[31]||(d[31]=[(0,u.eW)(" 确定 ")]))),_:1},8,["loading"])])),default:(0,u.k6)((()=>[(0,u.bF)(G,{ref_key:"editFormRef",ref:j,model:C,rules:x,"label-width":"100px"},{default:(0,u.k6)((()=>[(0,u.bF)(o,{label:"学号",prop:"stu_num"},{default:(0,u.k6)((()=>[(0,u.bF)(m,{modelValue:C.stu_num,"onUpdate:modelValue":d[7]||(d[7]=e=>C.stu_num=e)},null,8,["modelValue"])])),_:1}),(0,u.bF)(o,{label:"姓名",prop:"stu_name"},{default:(0,u.k6)((()=>[(0,u.bF)(m,{modelValue:C.stu_name,"onUpdate:modelValue":d[8]||(d[8]=e=>C.stu_name=e)},null,8,["modelValue"])])),_:1}),(0,u.bF)(o,{label:"年级",prop:"stu_gde"},{default:(0,u.k6)((()=>[(0,u.bF)(s,{modelValue:C.stu_gde,"onUpdate:modelValue":d[9]||(d[9]=e=>C.stu_gde=e),style:{width:"100%"}},{default:(0,u.k6)((()=>[((0,u.uX)(!0),(0,u.CE)(u.FK,null,(0,u.pI)(v.value,(e=>((0,u.uX)(),(0,u.Wv)(n,{key:e.gde_id,label:`${e.gde_value}级`,value:e.gde_value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,u.bF)(o,{label:"专业",prop:"stu_mjr"},{default:(0,u.k6)((()=>[(0,u.bF)(s,{modelValue:C.stu_mjr,"onUpdate:modelValue":d[10]||(d[10]=e=>C.stu_mjr=e),style:{width:"100%"}},{default:(0,u.k6)((()=>[((0,u.uX)(!0),(0,u.CE)(u.FK,null,(0,u.pI)(F.value,(e=>((0,u.uX)(),(0,u.Wv)(n,{key:e.mjr_id,label:e.mjr_name,value:e.mjr_name},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,u.bF)(o,{label:"班级",prop:"stu_cls"},{default:(0,u.k6)((()=>[(0,u.bF)(le,{modelValue:C.stu_cls,"onUpdate:modelValue":d[11]||(d[11]=e=>C.stu_cls=e),min:1,max:100,style:{width:"100%"}},null,8,["modelValue"])])),_:1}),(0,u.bF)(o,{label:"联系方式",prop:"stu_phone"},{default:(0,u.k6)((()=>[(0,u.bF)(m,{modelValue:C.stu_phone,"onUpdate:modelValue":d[12]||(d[12]=e=>C.stu_phone=e)},null,8,["modelValue"])])),_:1}),C.stu_group?((0,u.uX)(),(0,u.Wv)(o,{key:0,label:"组长"},{default:(0,u.k6)((()=>[(0,u.bF)(ae,{modelValue:C.stu_lead,"onUpdate:modelValue":d[13]||(d[13]=e=>C.stu_lead=e),"active-text":"是","inactive-text":"否","active-value":!0,"inactive-value":!1},null,8,["modelValue"])])),_:1})):(0,u.Q3)("",!0)])),_:1},8,["model"])])),_:1},8,["modelValue"]),(0,u.bF)(ue,{modelValue:N.value,"onUpdate:modelValue":d[19]||(d[19]=e=>N.value=e),title:"批量导入学生",width:"50%"},{footer:(0,u.k6)((()=>[(0,u.bF)(W,{type:"primary",onClick:Y},{default:(0,u.k6)((()=>[(0,u.bF)(_,null,{default:(0,u.k6)((()=>[(0,u.bF)((0,t.R1)(i.f5X))])),_:1}),d[34]||(d[34]=(0,u.eW)(" 下载模板 "))])),_:1}),(0,u.bF)(W,{onClick:d[18]||(d[18]=e=>N.value=!1)},{default:(0,u.k6)((()=>d[35]||(d[35]=[(0,u.eW)("取消")]))),_:1}),(0,u.bF)(W,{type:"primary",onClick:D,loading:B.value},{default:(0,u.k6)((()=>d[36]||(d[36]=[(0,u.eW)(" 确定导入 ")]))),_:1},8,["loading"])])),default:(0,u.k6)((()=>[(0,u.bF)(G,{ref_key:"importFormRef",ref:S,model:T,rules:A,"label-width":"100px"},{default:(0,u.k6)((()=>[(0,u.bF)(o,{label:"年级",prop:"grade"},{default:(0,u.k6)((()=>[(0,u.bF)(s,{modelValue:T.grade,"onUpdate:modelValue":d[16]||(d[16]=e=>T.grade=e),style:{width:"100%"}},{default:(0,u.k6)((()=>[((0,u.uX)(!0),(0,u.CE)(u.FK,null,(0,u.pI)(v.value,(e=>((0,u.uX)(),(0,u.Wv)(n,{key:e.gde_id,label:`${e.gde_value}级`,value:e.gde_id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,u.bF)(o,{label:"专业",prop:"major"},{default:(0,u.k6)((()=>[(0,u.bF)(s,{modelValue:T.major,"onUpdate:modelValue":d[17]||(d[17]=e=>T.major=e),style:{width:"100%"}},{default:(0,u.k6)((()=>[((0,u.uX)(!0),(0,u.CE)(u.FK,null,(0,u.pI)(F.value,(e=>((0,u.uX)(),(0,u.Wv)(n,{key:e.mjr_id,label:e.mjr_name,value:e.mjr_id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,u.bF)(o,{label:"Excel文件",prop:"file"},{default:(0,u.k6)((()=>[(0,u.bF)(te,{class:"upload-demo",action:"#","auto-upload":!1,"on-change":Q,limit:1,accept:".xlsx,.xls"},{trigger:(0,u.k6)((()=>[(0,u.bF)(W,{type:"primary"},{default:(0,u.k6)((()=>d[32]||(d[32]=[(0,u.eW)("选择文件")]))),_:1})])),tip:(0,u.k6)((()=>d[33]||(d[33]=[(0,u.Lk)("div",{class:"el-upload__tip"}," 请上传Excel文件，文件大小不超过10MB ",-1)]))),_:1})])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue"])])}}},v=a(1241);const F=(0,v.A)(k,[["__scopeId","data-v-448913ea"]]);var h=F}}]);
//# sourceMappingURL=302.eaddc08b.js.map