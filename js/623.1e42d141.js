"use strict";(self["webpackChunkgdmu_mentor_selection"]=self["webpackChunkgdmu_mentor_selection"]||[]).push([[623],{3623:function(e,a,l){l.r(a),l.d(a,{default:function(){return T}});l(4114),l(8992),l(4520),l(2577),l(1454);var t=l(6768),u=l(144),n=l(4232),d=l(7477),o=l(1387),s=l(4267),r=l(8298),i=l(6135),c=l(3555),v=l(1219),b=l(3230);const _={class:"dashboard"},k={class:"card-header"},p={class:"title"},m={class:"allocation-content"},h={class:"allocation-form"},f={key:0,class:"allocation-results"},g={class:"table-controls"},F={class:"card-header"},y={class:"title"},w={class:"stats-content full-width"},C={class:"filter-area"},W={class:"card-header"},j={class:"title"},R={class:"stats-content full-width"},K={class:"filter-area"},V={class:"dialog-content"},L={class:"dialog-header"},X={class:"pagination"};var $={__name:"admin-dashboard",setup(e){const a=(0,o.rd)(),l=(0,u.KR)(!1),$=(0,u.KR)(!1),E=(0,u.KR)([]),x=(0,u.KR)([]),T=(0,u.KR)(""),U=(0,u.KR)([]),z=(0,u.KR)(!1),I=(0,u.KR)([]),P=(0,u.KR)(""),Q=(0,u.KR)(!1),S=(0,u.KR)(1),q=(0,u.KR)(10),N=(0,t.EW)((()=>{const e=(S.value-1)*q.value,a=e+q.value;return I.value.slice(e,a)})),O=async()=>{try{const[e,a]=await Promise.all([(0,s.O)(),(0,r.Q)()]);E.value=e,x.value=a,e.length&&(T.value=e[0].gde_value,await A())}catch(e){v.nk.error("获取基础数据失败")}},A=async()=>{if(T.value){l.value=!0;try{const e=await Promise.all(x.value.map((async e=>{const a=await(0,i.e_)(T.value,e.mjr_name);return{major:e.mjr_name,unsetCount:a.length}})));U.value=e}catch(e){v.nk.error("获取统计数据失败")}finally{l.value=!1}}},D=async e=>{$.value=!0,S.value=1;try{const a=await(0,i.e_)(T.value,e.major);I.value=a,P.value=e.major,z.value=!0}catch(a){v.nk.error("获取学生名单失败")}finally{$.value=!1}},B=()=>{A()},G=()=>{A()},H=e=>{q.value=e,S.value=1},J=e=>{S.value=e},M=async()=>{if(I.value.length){Q.value=!0;try{const e=I.value.map((e=>({"学号":e.stu_num,"姓名":e.stu_name,"班级":e.stu_cls,"联系方式":e.stu_phone}))),a=b.Wp.book_new(),l=b.Wp.json_to_sheet(e),t=[{wch:15},{wch:10},{wch:10},{wch:15}];l["!cols"]=t,b.Wp.book_append_sheet(a,l,`${T.value}级${P.value}未分组学生`),b._h(a,`${T.value}级${P.value}未分组学生名单.xlsx`),v.nk.success("导出成功")}catch(e){console.error("导出失败:",e),v.nk.error("导出失败")}finally{Q.value=!1}}else v.nk.warning("没有可导出的数据")},Y=(0,u.KR)(!1),Z=(0,u.KR)(""),ee=(0,u.KR)([]),ae=async()=>{if(Z.value){Y.value=!0;try{const e=await Promise.all(x.value.map((async e=>{const[a,l,t,u]=await Promise.all([(0,c.Fw)(Z.value,e.mjr_name),(0,c.TR)(Z.value,e.mjr_name),(0,c.Dz)(Z.value,e.mjr_name),(0,c.rW)(Z.value,e.mjr_name)]);return{major:e.mjr_name,unselectedCount:a.length,notFullCount:l.length,withoutTeacherCount:t.length,withTeacherCount:u.length}})));ee.value=e}catch(e){v.nk.error("获取小组统计数据失败")}finally{Y.value=!1}}},le=()=>{ae()},te=()=>{ae()},ue=(e,l)=>{a.push({path:"/system-management/manage/group",query:{grade:Z.value,major:e,type:l}})},ne=(0,u.KR)({grade:"",major:""}),de=(0,u.KR)(!1),oe=(0,u.KR)([]),se=(0,u.KR)(!0),re=(0,t.EW)((()=>oe.value.filter((e=>e.details.teacher)))),ie=async()=>{if(ne.value.grade&&ne.value.major){de.value=!0;try{const e=await(0,c.Q)(ne.value.grade,ne.value.major);oe.value=e,v.nk.success("分配完成")}catch(e){v.nk.error("分配失败")}finally{de.value=!1}}else v.nk.warning("请选择年级和专业")},ce=e=>{const a=e.find((e=>e.stu_lead));return a?a.stu_name:"未设置"},ve=()=>{const e=oe.value.filter((e=>e.details.teacher)).map((e=>({"小组名称":e.group_name,"选题":e.group_title,"组长":ce(e.details.studentsList),"成员":e.details.studentsList.map((e=>e.stu_name)).join("、"),"指导教师":e.details.teacher.tea_name}))),a=b.Wp.book_new(),l=b.Wp.json_to_sheet(e);l["!cols"]=[{wch:15},{wch:30},{wch:10},{wch:40},{wch:15}],b.Wp.book_append_sheet(a,l,`${ne.value.find((e=>e.gde_id===ne.value.grade))?.gde_value}级分配结果`),b._h(a,`${ne.value.find((e=>e.gde_id===ne.value.grade))?.gde_value}级${x.value.find((e=>e.mjr_id===ne.value.major))?.mjr_name}分配结果.xlsx`)},be=(0,u.KR)("allocation");return(0,t.sV)((()=>{O()})),(e,a)=>{const o=(0,t.g2)("el-icon"),s=(0,t.g2)("el-option"),r=(0,t.g2)("el-select"),i=(0,t.g2)("el-form-item"),c=(0,t.g2)("el-button"),v=(0,t.g2)("el-form"),b=(0,t.g2)("el-button-group"),O=(0,t.g2)("el-table-column"),A=(0,t.g2)("el-table"),ae=(0,t.g2)("el-card"),_e=(0,t.g2)("el-tab-pane"),ke=(0,t.g2)("el-tag"),pe=(0,t.g2)("el-tabs"),me=(0,t.g2)("el-pagination"),he=(0,t.g2)("el-dialog"),fe=(0,t.gN)("loading");return(0,t.uX)(),(0,t.CE)("div",_,[(0,t.bF)(ae,{class:"content-card"},{default:(0,t.k6)((()=>[(0,t.bF)(pe,{modelValue:be.value,"onUpdate:modelValue":a[6]||(a[6]=e=>be.value=e)},{default:(0,t.k6)((()=>[(0,t.bF)(_e,{label:"分配管理",name:"allocation"},{default:(0,t.k6)((()=>[(0,t.bF)(ae,{class:"stats-card"},{header:(0,t.k6)((()=>[(0,t.Lk)("div",k,[(0,t.Lk)("span",p,[(0,t.bF)(o,null,{default:(0,t.k6)((()=>[(0,t.bF)((0,u.R1)(d.IaS))])),_:1}),a[10]||(a[10]=(0,t.eW)(" 分配管理 "))])])])),default:(0,t.k6)((()=>[(0,t.Lk)("div",m,[(0,t.Lk)("div",h,[(0,t.bF)(v,{inline:!0},{default:(0,t.k6)((()=>[(0,t.bF)(i,{label:"年级",style:{width:"200px"}},{default:(0,t.k6)((()=>[(0,t.bF)(r,{modelValue:ne.value.grade,"onUpdate:modelValue":a[0]||(a[0]=e=>ne.value.grade=e),placeholder:"选择年级",style:{width:"100%"}},{default:(0,t.k6)((()=>[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(E.value,(e=>((0,t.uX)(),(0,t.Wv)(s,{key:e.gde_id,label:`${e.gde_value}级`,value:e.gde_id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,t.bF)(i,{label:"专业",style:{width:"300px"}},{default:(0,t.k6)((()=>[(0,t.bF)(r,{modelValue:ne.value.major,"onUpdate:modelValue":a[1]||(a[1]=e=>ne.value.major=e),placeholder:"选择专业",style:{width:"100%"}},{default:(0,t.k6)((()=>[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(x.value,(e=>((0,t.uX)(),(0,t.Wv)(s,{key:e.mjr_id,label:e.mjr_name,value:e.mjr_id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,t.bF)(i,null,{default:(0,t.k6)((()=>[(0,t.bF)(c,{type:"primary",onClick:ie,loading:de.value},{default:(0,t.k6)((()=>a[11]||(a[11]=[(0,t.eW)(" 自动分配 ")]))),_:1},8,["loading"]),(0,t.bF)(c,{type:"success",onClick:ve,disabled:!oe.value.length},{default:(0,t.k6)((()=>[(0,t.bF)(o,null,{default:(0,t.k6)((()=>[(0,t.bF)((0,u.R1)(d.f5X))])),_:1}),a[12]||(a[12]=(0,t.eW)(" 导出结果 "))])),_:1},8,["disabled"])])),_:1})])),_:1})]),oe.value.length?((0,t.uX)(),(0,t.CE)("div",f,[(0,t.Lk)("div",g,[(0,t.bF)(b,null,{default:(0,t.k6)((()=>[(0,t.bF)(c,{type:se.value?"":"primary",onClick:a[2]||(a[2]=e=>se.value=!1)},{default:(0,t.k6)((()=>a[13]||(a[13]=[(0,t.eW)(" 展开 ")]))),_:1},8,["type"]),(0,t.bF)(c,{type:se.value?"primary":"",onClick:a[3]||(a[3]=e=>se.value=!0)},{default:(0,t.k6)((()=>a[14]||(a[14]=[(0,t.eW)(" 收起 ")]))),_:1},8,["type"])])),_:1})]),(0,t.bF)(A,{data:re.value,stripe:"",border:"","max-height":se.value?"300":"600"},{default:(0,t.k6)((()=>[(0,t.bF)(O,{prop:"group_name",label:"小组名称"}),(0,t.bF)(O,{prop:"group_title",label:"选题","show-overflow-tooltip":""}),(0,t.bF)(O,{label:"组长"},{default:(0,t.k6)((({row:e})=>[(0,t.eW)((0,n.v_)(ce(e.details.studentsList)),1)])),_:1}),(0,t.bF)(O,{label:"成员数"},{default:(0,t.k6)((({row:e})=>[(0,t.eW)((0,n.v_)(e.details.studentsList.length)+"人 ",1)])),_:1}),(0,t.bF)(O,{label:"指导教师"},{default:(0,t.k6)((({row:e})=>[(0,t.eW)((0,n.v_)(e.details.teacher?.tea_name),1)])),_:1})])),_:1},8,["data","max-height"])])):(0,t.Q3)("",!0)])])),_:1})])),_:1}),(0,t.bF)(_e,{label:"未分组学生统计",name:"unset"},{default:(0,t.k6)((()=>[(0,t.bF)(ae,{class:"stats-card"},{header:(0,t.k6)((()=>[(0,t.Lk)("div",F,[(0,t.Lk)("span",y,[(0,t.bF)(o,null,{default:(0,t.k6)((()=>[(0,t.bF)((0,u.R1)(d.dlO))])),_:1}),a[15]||(a[15]=(0,t.eW)(" 未分组学生统计 "))]),(0,t.bF)(c,{type:"primary",link:"",onClick:G},{default:(0,t.k6)((()=>[(0,t.bF)(o,null,{default:(0,t.k6)((()=>[(0,t.bF)((0,u.R1)(d.C42))])),_:1}),a[16]||(a[16]=(0,t.eW)(" 刷新 "))])),_:1})])])),default:(0,t.k6)((()=>[(0,t.bo)(((0,t.uX)(),(0,t.CE)("div",w,[(0,t.Lk)("div",C,[(0,t.bF)(r,{modelValue:T.value,"onUpdate:modelValue":a[4]||(a[4]=e=>T.value=e),placeholder:"选择年级",clearable:"",onChange:B},{default:(0,t.k6)((()=>[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(E.value,(e=>((0,t.uX)(),(0,t.Wv)(s,{key:e.gde_id,label:`${e.gde_value}级`,value:e.gde_value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])]),(0,t.bF)(A,{data:U.value,stripe:"",class:"full-width-table"},{default:(0,t.k6)((()=>[(0,t.bF)(O,{prop:"major",label:"专业",width:"40%"}),(0,t.bF)(O,{prop:"unsetCount",label:"未分组人数",width:"30%"},{default:(0,t.k6)((({row:e})=>[(0,t.bF)(ke,{type:e.unsetCount>0?"danger":"success",effect:"dark"},{default:(0,t.k6)((()=>[(0,t.eW)((0,n.v_)(e.unsetCount)+" 人 ",1)])),_:2},1032,["type"])])),_:1}),(0,t.bF)(O,{label:"操作",width:"30%"},{default:(0,t.k6)((({row:e})=>[(0,t.bF)(c,{type:"primary",link:"",onClick:a=>D(e),disabled:0===e.unsetCount},{default:(0,t.k6)((()=>a[17]||(a[17]=[(0,t.eW)(" 查看名单 ")]))),_:2},1032,["onClick","disabled"])])),_:1})])),_:1},8,["data"])])),[[fe,l.value]])])),_:1})])),_:1}),(0,t.bF)(_e,{label:"小组情况统计",name:"groups"},{default:(0,t.k6)((()=>[(0,t.bF)(ae,{class:"stats-card"},{header:(0,t.k6)((()=>[(0,t.Lk)("div",W,[(0,t.Lk)("span",j,[(0,t.bF)(o,null,{default:(0,t.k6)((()=>[(0,t.bF)((0,u.R1)(d.Ngq))])),_:1}),a[18]||(a[18]=(0,t.eW)(" 小组情况统计 "))]),(0,t.bF)(c,{type:"primary",link:"",onClick:te},{default:(0,t.k6)((()=>[(0,t.bF)(o,null,{default:(0,t.k6)((()=>[(0,t.bF)((0,u.R1)(d.C42))])),_:1}),a[19]||(a[19]=(0,t.eW)(" 刷新 "))])),_:1})])])),default:(0,t.k6)((()=>[(0,t.bo)(((0,t.uX)(),(0,t.CE)("div",R,[(0,t.Lk)("div",K,[(0,t.bF)(r,{modelValue:Z.value,"onUpdate:modelValue":a[5]||(a[5]=e=>Z.value=e),placeholder:"选择年级",clearable:"",onChange:le},{default:(0,t.k6)((()=>[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(E.value,(e=>((0,t.uX)(),(0,t.Wv)(s,{key:e.gde_id,label:`${e.gde_value}级`,value:e.gde_value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])]),(0,t.bF)(A,{data:ee.value,stripe:"",class:"full-width-table"},{default:(0,t.k6)((()=>[(0,t.bF)(O,{prop:"major",label:"专业",width:"25%"}),(0,t.bF)(O,{label:"未预选小组",width:"18%"},{default:(0,t.k6)((({row:e})=>[(0,t.bF)(ke,{type:e.unselectedCount>0?"danger":"success",effect:"dark"},{default:(0,t.k6)((()=>[(0,t.eW)((0,n.v_)(e.unselectedCount)+" 组 ",1)])),_:2},1032,["type"]),(0,t.bF)(c,{type:"primary",link:"",onClick:a=>ue(e.major,"unselected"),disabled:0===e.unselectedCount},{default:(0,t.k6)((()=>a[20]||(a[20]=[(0,t.eW)(" 查看 ")]))),_:2},1032,["onClick","disabled"])])),_:1}),(0,t.bF)(O,{label:"未满人小组",width:"18%"},{default:(0,t.k6)((({row:e})=>[(0,t.bF)(ke,{type:e.notFullCount>0?"warning":"success",effect:"dark"},{default:(0,t.k6)((()=>[(0,t.eW)((0,n.v_)(e.notFullCount)+" 组 ",1)])),_:2},1032,["type"]),(0,t.bF)(c,{type:"primary",link:"",onClick:a=>ue(e.major,"not-full"),disabled:0===e.notFullCount},{default:(0,t.k6)((()=>a[21]||(a[21]=[(0,t.eW)(" 查看 ")]))),_:2},1032,["onClick","disabled"])])),_:1}),(0,t.bF)(O,{label:"未分配导师小组",width:"20%"},{default:(0,t.k6)((({row:e})=>[(0,t.bF)(ke,{type:e.withoutTeacherCount>0?"warning":"success",effect:"dark"},{default:(0,t.k6)((()=>[(0,t.eW)((0,n.v_)(e.withoutTeacherCount)+" 组 ",1)])),_:2},1032,["type"]),(0,t.bF)(c,{type:"primary",link:"",onClick:a=>ue(e.major,"without-teacher"),disabled:0===e.withoutTeacherCount},{default:(0,t.k6)((()=>a[22]||(a[22]=[(0,t.eW)(" 查看 ")]))),_:2},1032,["onClick","disabled"])])),_:1}),(0,t.bF)(O,{label:"已分配导师小组",width:"19%"},{default:(0,t.k6)((({row:e})=>[(0,t.bF)(ke,{type:e.withTeacherCount>0?"success":"info",effect:"dark"},{default:(0,t.k6)((()=>[(0,t.eW)((0,n.v_)(e.withTeacherCount)+" 组 ",1)])),_:2},1032,["type"]),(0,t.bF)(c,{type:"primary",link:"",onClick:a=>ue(e.major,"with-teacher"),disabled:0===e.withTeacherCount},{default:(0,t.k6)((()=>a[23]||(a[23]=[(0,t.eW)(" 查看 ")]))),_:2},1032,["onClick","disabled"])])),_:1})])),_:1},8,["data"])])),[[fe,Y.value]])])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1}),(0,t.bF)(he,{modelValue:z.value,"onUpdate:modelValue":a[9]||(a[9]=e=>z.value=e),title:`${T.value}级${P.value} - 未分组学生名单`,width:"70%"},{default:(0,t.k6)((()=>[(0,t.Lk)("div",V,[(0,t.Lk)("div",L,[(0,t.bF)(c,{type:"primary",onClick:M,loading:Q.value},{default:(0,t.k6)((()=>[(0,t.bF)(o,null,{default:(0,t.k6)((()=>[(0,t.bF)((0,u.R1)(d.f5X))])),_:1}),a[24]||(a[24]=(0,t.eW)(" 导出名单 "))])),_:1},8,["loading"])]),(0,t.bo)(((0,t.uX)(),(0,t.Wv)(A,{data:N.value,stripe:""},{default:(0,t.k6)((()=>[(0,t.bF)(O,{prop:"stu_num",label:"学号"}),(0,t.bF)(O,{prop:"stu_name",label:"姓名"}),(0,t.bF)(O,{prop:"stu_cls",label:"班级"}),(0,t.bF)(O,{prop:"stu_phone",label:"联系方式"})])),_:1},8,["data"])),[[fe,$.value]]),(0,t.Lk)("div",X,[(0,t.bF)(me,{"current-page":S.value,"onUpdate:currentPage":a[7]||(a[7]=e=>S.value=e),"page-size":q.value,"onUpdate:pageSize":a[8]||(a[8]=e=>q.value=e),total:I.value.length,"page-sizes":[10,20,30,50],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:H,onCurrentChange:J},null,8,["current-page","page-size","total"])])])])),_:1},8,["modelValue","title"])])}}},E=l(1241);const x=(0,E.A)($,[["__scopeId","data-v-477d7cfb"]]);var T=x}}]);
//# sourceMappingURL=623.1e42d141.js.map